# 🏠 HomeDCIM 家庭DCIM功能完整指南

## 概述

这份文档描述了 HomeDCIM 为家庭用户添加的各种实用功能，包括：
- **功率管理** - 监控和优化能耗
- **网络管理** - 追踪网络连接配置
- **资产追踪** - 管理设备购买和保修信息
- **告警监控** - 系统状态监测和告警
- **容量规划** - 机柜空间和功率分析
- **设备模板** - 预定义常见设备规格

---

## 📊 功能详细说明

### 1. 功率管理 ⚡

**位置**：设备管理 → 功率管理标签

#### 功能特性
- 实时显示全系统总功率消耗
- 功率利用率可视化进度条
- 与设置的最大功率限制对比
- 单个设备功率编辑
- 超限告警提示

#### 如何使用

**添加设备功率：**
1. 打开仪表盘，创建或编辑设备
2. 在设备信息中输入 `powerW` 字段（单位：瓦特）
3. 或在设备管理 → 功率管理中点击"编辑"添加

**设置功率限制：**
1. 打开设备管理 → 功率管理
2. 在"设置最大功率限制"中输入值（单位：W）
3. 点击"保存"

**示例数据：**
```
交换机: 100W
NAS 存储: 50W
家庭服务器: 200W
显示器: 30W
路由器: 20W
总计: 400W / 3000W (13%)
```

#### API 端点
- `GET /api/power-summary` - 获取功率统计信息
- `PUT /api/settings` - 设置最大功率限制

---

### 2. 网络连接管理 🌐

**位置**：设备管理 → 网络连接标签

#### 功能特性
- 记录设备 IP 地址
- 记录设备 MAC 地址
- 管理网络交换机端口映射
- 快速查询设备网络配置

#### 如何使用

**编辑网络信息：**
1. 打开设备管理 → 网络连接
2. 找到要编辑的设备，点击"编辑"
3. 输入 IP 地址和 MAC 地址
4. 保存

**示例配置：**
```
设备: HomeLab Server
IP: 192.168.1.100
MAC: AA:BB:CC:DD:EE:FF
交换机端口: G1/0/1
```

#### API 端点
- `PUT /api/devices/{id}/network` - 更新网络配置

#### 字段说明
| 字段 | 说明 | 示例 |
|------|------|------|
| ip | IPv4 地址 | 192.168.1.100 |
| mac | MAC 地址 | AA:BB:CC:DD:EE:FF |
| ports | 端口列表 | GE1,GE2 |
| switchPort | 交换机端口 | G1/0/1 |

---

### 3. 资产追踪 📦

**位置**：设备管理 → 资产追踪标签

#### 功能特性
- 记录设备序列号
- 追踪购买日期和价格
- 管理保修期信息
- 保存设备手册链接

#### 如何使用

**添加资产信息：**
1. 打开设备管理 → 资产追踪
2. 找到要编辑的设备，点击"编辑"
3. 输入序列号、购买日期、保修期等信息
4. 保存

**示例数据：**
```
设备: Synology NAS
序列号: SN123456789
购买日期: 2023-06-15
价格: ¥3,500
保修期至: 2026-06-15
手册: https://example.com/manual.pdf
```

#### API 端点
- `PUT /api/devices/{id}/asset` - 更新资产信息

#### 字段说明
| 字段 | 说明 | 格式 |
|------|------|------|
| serialNumber | 序列号 | 文本 |
| purchaseDate | 购买日期 | YYYY-MM-DD |
| purchasePrice | 购买价格 | 数字 |
| warrantyEnd | 保修期至 | YYYY-MM-DD |
| manualUrl | 设备手册链接 | URL |

---

### 4. 告警和监控 🚨

**位置**：设备管理 → 告警监控标签 / 分析报表

#### 功能特性
- 系统自动生成告警（温度、功率超限等）
- 手动创建和确认告警
- 告警历史记录
- 告警分类（信息、警告、错误）

#### 告警类型

| 类型 | 触发条件 | 严重级别 |
|------|---------|--------|
| `power.high` | 功率超过限制 | warning |
| `temperature.high` | 温度超过阈值 | warning |
| `device.offline` | 设备离线 | error |
| `capacity.warning` | 机柜容量即将满满 | warning |

#### 创建手动告警

**通过 API：**
```bash
curl -X POST http://localhost:3001/api/alerts \
  -H "Content-Type: application/json" \
  -d '{
    "type": "maintenance.required",
    "message": "需要清理冷却通风道",
    "deviceId": 1,
    "severity": "warning"
  }'
```

#### 确认告警
1. 打开设备管理 → 告警监控
2. 点击"全部确认"或单个告警的确认按钮

#### API 端点
- `POST /api/alerts` - 创建告警
- `GET /api/alerts` - 获取所有告警
- `PUT /api/alerts/{id}/acknowledge` - 确认告警

---

### 5. 容量规划 📈

**位置**：分析报表

#### 功能特性
- 机柜空间利用率分析
- 功率分布和瓶颈识别
- U位使用情况统计
- 前10大功率消耗设备排行

#### 报表内容

**机柜概览：**
- 总机柜数
- 总设备数
- 在线设备数
- 活跃告警数

**机柜容量：**
- 已用/总 U 位
- 剩余 U 位
- 利用率百分比
- 总功率消耗

**排行分析：**
- 功率消耗排行
- 设备数量排行
- 容量利用率排行

#### 使用示例

```
机柜 A：
- 设备数: 8
- U 位: 20/42 (47.6%)
- 剩余: 22 U 位
- 功率: 450W / 3000W

机柜 B：
- 设备数: 6
- U 位: 15/42 (35.7%)
- 剩余: 27 U 位
- 功率: 300W / 3000W
```

#### API 端点
- `GET /api/capacity-analysis` - 获取容量分析数据
- `GET /api/reports/capacity` - 生成完整报告

---

### 6. 设备模板 🔧

**位置**：设备管理 → 设备模板标签

#### 功能特性
- 预定义常见设备规格
- 快速创建同类型设备
- 自动填充功率和配置
- 模板库管理

#### 预定义模板

| 名称 | 类型 | 功率 | 备注 |
|------|------|------|------|
| 2U 服务器 | Server | 400W | 双路CPU |
| 交换机 48 端口 | Network | 100W | 标准交换机 |
| 1U NAS | Storage | 80W | 4 盘位 |
| 显示器 27" | Monitor | 40W | LED |
| 家庭路由器 | Router | 20W | WiFi 6 |

#### 创建模板

1. 打开设备管理 → 设备模板
2. 点击"新增模板"
3. 输入模板信息：
   - 模板名称（如"2U 服务器"）
   - 类型（如"Server"）
   - 功率（如"400"）
4. 保存

#### 使用模板

1. 创建新设备时，选择模板
2. 系统会自动填充：
   - 设备类型
   - 预设功率
   - 高度 (U 位)

#### API 端点
- `POST /api/templates` - 创建模板
- `GET /api/templates` - 获取模板列表
- `DELETE /api/templates/{id}` - 删除模板

---

### 7. 环境监控 🌡️

**位置**：分析报表 → 环境监测部分

#### 监测项目

| 项目 | 建议范围 | 危险阈值 |
|------|---------|--------|
| 温度 | 18-27°C | > 45°C |
| 湿度 | 40-60% | < 20% 或 > 80% |
| 气流 | 100+ CFM | 可配置 |

#### 告警条件

```
IF 温度 > maxTemp → 发送告警
IF 功率 > maxPower → 发送告警
IF 设备离线 > 5分钟 → 发送告警
IF U位利用率 > 95% → 发送容量告警
```

#### 配置示例

```javascript
// 设置系统参数
{
  "maxPower": 3000,      // 最大功率 (W)
  "maxTemp": 45,         // 最大温度 (°C)
  "autoAlert": true      // 启用自动告警
}
```

---

### 8. 系统设置 ⚙️

**位置**：设备管理 → 功率管理

#### 可配置参数

| 参数 | 默认值 | 说明 |
|------|-------|------|
| `maxPower` | 3000 | 机柜最大功率限制 (W) |
| `maxTemp` | 45 | 最高允许温度 (°C) |
| `autoAlert` | true | 是否启用自动告警 |

#### 修改设置

**通过 UI：**
1. 打开设备管理 → 功率管理
2. 在底部找到"设置最大功率限制"
3. 输入新值并保存

**通过 API：**
```bash
curl -X PUT http://localhost:3001/api/settings \
  -H "Content-Type: application/json" \
  -d '{"maxPower": 5000, "maxTemp": 50}'
```

#### API 端点
- `GET /api/settings` - 获取当前设置
- `PUT /api/settings` - 更新设置

---

## 📱 工作流示例

### 示例 1: 新增一台服务器

1. **创建设备**
   - 打开仪表盘，点击"新建"
   - 选择机柜和 U 位
   - 输入设备名称："HomeLab Server"
   - 选择类型："Server"

2. **添加网络信息**
   - 打开设备管理 → 网络连接
   - 找到新设备，点击"编辑"
   - 输入 IP: 192.168.1.100
   - 输入 MAC: AA:BB:CC:DD:EE:FF

3. **添加资产信息**
   - 打开设备管理 → 资产追踪
   - 找到新设备，点击"编辑"
   - 输入序列号、购买日期、保修期

4. **设置功率**
   - 打开设备管理 → 功率管理
   - 找到新设备，点击"编辑"
   - 输入功率: 400W

5. **查看分析**
   - 打开分析报表
   - 查看新设备是否出现在功率排行和容量分析中

---

### 示例 2: 监控功率告警

1. **设置功率限制**
   - 打开设备管理 → 功率管理
   - 设置最大功率: 2000W

2. **添加设备**
   - 添加功率为 1500W 的设备 A
   - 添加功率为 700W 的设备 B
   - 总功率 2200W（超过限制）

3. **系统告警**
   - 设备管理 → 告警监控中出现告警
   - 分析报表中显示警告提示

4. **处理告警**
   - 关闭不需要的设备
   - 或提高功率限制
   - 点击"全部确认"清除告警

---

## 🔌 设备字段参考

### 完整设备对象

```javascript
{
  // 基础信息
  id: 1,
  name: "HomeLab Server",
  type: "Server",
  ip: "192.168.1.100",
  cabinetId: 1,
  position: 10,
  heightU: 2,
  
  // 功率管理
  powerW: 400,
  
  // 网络信息
  mac: "AA:BB:CC:DD:EE:FF",
  ports: ["GE1", "GE2"],
  switchPort: "G1/0/1",
  
  // 资产信息
  serialNumber: "SN123456789",
  purchaseDate: "2023-06-15",
  purchasePrice: 3500,
  warrantyEnd: "2026-06-15",
  manualUrl: "https://example.com/manual.pdf",
  
  // 状态
  online: true,
  lastChecked: "2025-12-03T13:58:48Z",
  
  // 元数据
  created_at: "2025-12-03T10:00:00Z",
  description: "主要家庭服务器"
}
```

---

## 📊 快速参考

### 常用 API 调用

**获取功率统计：**
```bash
GET /api/power-summary
```

**获取容量分析：**
```bash
GET /api/capacity-analysis
```

**生成报告：**
```bash
GET /api/reports/capacity
```

**获取所有设置：**
```bash
GET /api/settings
```

**创建告警：**
```bash
POST /api/alerts
Content-Type: application/json

{
  "type": "maintenance",
  "message": "例行维护提醒",
  "severity": "info"
}
```

---

## 🎯 最佳实践

### 功率管理

✅ **推荐做法**
- 定期更新设备功率信息
- 设置合理的功率限制
- 监控功率告警并及时响应
- 定期检查功率消耗趋势

❌ **避免**
- 长期忽视功率告警
- 不准确的功率记录
- 未经规划的大功率设备添加

### 容量规划

✅ **推荐做法**
- 保持 U 位利用率在 70-80%
- 预留维护空间
- 定期备份配置
- 使用模板加快部署

❌ **避免**
- 过度填充机柜（>90%）
- 混乱的设备放置
- 不记录设备信息

### 告警管理

✅ **推荐做法**
- 定期检查告警
- 及时确认已解决的告警
- 设置合理的告警阈值
- 记录告警处理过程

❌ **避免**
- 忽视告警
- 过度灵敏的告警设置
- 未确认的陈旧告警积累

---

## 📚 更多资源

- 主仪表盘：http://localhost:3001
- SSH 终端：http://localhost:3001/ssh.html
- VNC 远程：http://localhost:3001/vnc.html
- 设备管理：http://localhost:3001/management.html
- 分析报表：http://localhost:3001/analytics.html

---

**版本**：v0.2（新增家庭DCIM功能）  
**最后更新**：2025-12-03  
**维护者**：HomeDCIM 项目
