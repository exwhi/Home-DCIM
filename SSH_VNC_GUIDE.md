# HomeDCIM SSH & VNC é›†æˆä½¿ç”¨æŒ‡å—

## æ¦‚è§ˆ

Home-dcim ç°å·²é›†æˆ **SSH ç»ˆç«¯**å’Œ **VNC è¿œç¨‹æ¡Œé¢**åŠŸèƒ½ï¼Œæ”¯æŒåœ¨æµè§ˆå™¨ä¸­ç›´æ¥è¿›è¡Œè¿œç¨‹æ“ä½œã€‚

- **SSH ç»ˆç«¯** (`/ssh.html`)ï¼šé€šè¿‡ WebSocket ä»£ç†è¿æ¥è¿œç¨‹ SSH æœåŠ¡å™¨ï¼Œæä¾›å…¨åŠŸèƒ½ç»ˆç«¯
- **VNC è¿œç¨‹** (`/vnc.html`)ï¼šé€šè¿‡ websockify ä»£ç†å’Œ noVNC å®¢æˆ·ç«¯è¿æ¥ VNC æœåŠ¡å™¨

---

## SSH ç»ˆç«¯ä½¿ç”¨

### åŠŸèƒ½ç‰¹æ€§
- âœ… é€šè¿‡æµè§ˆå™¨ç›´æ¥è¿æ¥ SSH æœåŠ¡å™¨
- âœ… å®Œæ•´çš„ç»ˆç«¯æ”¯æŒï¼ˆä½¿ç”¨ xterm.jsï¼‰
- âœ… æ”¯æŒè¾“å…¥ç”¨æˆ·åã€å¯†ç å’Œè‡ªå®šä¹‰ç«¯å£
- âœ… å®æ—¶è¿æ¥çŠ¶æ€æŒ‡ç¤º
- âœ… æ‰€æœ‰è¿æ¥å°è¯•è‡ªåŠ¨è®°å½•åˆ°å®¡è®¡æ—¥å¿—

### ä½¿ç”¨æ­¥éª¤

1. **æ‰“å¼€ SSH é¡µé¢**
   ```
   http://localhost:3001/ssh.html
   ```

2. **å¡«å…¥è¿æ¥ä¿¡æ¯**
   - **ä¸»æœº**ï¼šç›®æ ‡ SSH æœåŠ¡å™¨åœ°å€ï¼ˆå¦‚ `192.168.1.10`ï¼‰
   - **ç«¯å£**ï¼šSSH æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤ `22`ï¼‰
   - **ç”¨æˆ·**ï¼šç™»å½•ç”¨æˆ·åï¼ˆå¦‚ `root`ã€`admin`ï¼‰
   - **å¯†ç **ï¼šç™»å½•å¯†ç 

3. **ç‚¹å‡»"è¿æ¥"æŒ‰é’®**
   - é¡µé¢ä¼šç«‹å³å°è¯•é€šè¿‡ WebSocket ä»£ç†è¿æ¥
   - å¦‚æœè¿æ¥æˆåŠŸï¼Œä¼šæ˜¾ç¤º Shell æç¤ºç¬¦
   - å¯ä»¥è¾“å…¥ä»»ä½• shell å‘½ä»¤ï¼ˆlsã€cdã€apt-get ç­‰ï¼‰

4. **æ–­å¼€è¿æ¥**
   - ç‚¹å‡»"æ–­å¼€"æŒ‰é’®æˆ–å…³é—­æµè§ˆå™¨æ ‡ç­¾é¡µ

### é¡µé¢å¸ƒå±€
- **å·¦ä¾§å¯¼èˆª**ï¼šHomeDCIM å“ç‰Œå’Œå¯¼èˆªèœå•
- **é¡¶éƒ¨æ **ï¼šé¡µé¢æ ‡é¢˜å’Œå®æ—¶è¿æ¥çŠ¶æ€æŒ‡ç¤ºï¼ˆç»¿è‰²/çº¢è‰²ï¼‰
- **æ§åˆ¶é¢æ¿**ï¼šè¾“å…¥å­—æ®µå’Œè¿æ¥æŒ‰é’®
- **ç»ˆç«¯åŒºåŸŸ**ï¼šxterm.js æä¾›çš„å…¨åŠŸèƒ½ç»ˆç«¯ä»¿çœŸå™¨

### æŠ€æœ¯ç»†èŠ‚
- å‰ç«¯ä½¿ç”¨ **xterm.js** è¿›è¡Œç»ˆç«¯æ¸²æŸ“
- åç«¯ä½¿ç”¨ **ssh2 Node.js åº“**å»ºç«‹ SSH è¿æ¥
- é€šè¿‡ **WebSocket** è¿›è¡ŒåŒå‘é€šä¿¡
- æ‰€æœ‰è¾“å…¥è¾“å‡ºå®æ—¶é€ä¼ ï¼Œé›¶å»¶è¿Ÿ

---

## VNC è¿œç¨‹ä½¿ç”¨

### å‰ç½®æ¡ä»¶
**websockify å¿…é¡»åœ¨ä¸»æœºä¸Šè¿è¡Œ**

#### Windows ç”¨æˆ·ï¼ˆæ¨è WSLï¼‰
```bash
# åœ¨ WSL ä¸­å®‰è£…
wsl
pip install websockify

# æˆ–è€…ç”¨ aptï¼ˆå¦‚æœæ˜¯ Ubuntuï¼‰
sudo apt-get update
sudo apt-get install websockify
```

#### Linux ç”¨æˆ·
```bash
# Debian/Ubuntu
sudo apt-get install websockify

# æˆ–ç”¨ pip
pip install websockify
```

#### macOS ç”¨æˆ·
```bash
# é€šè¿‡ Homebrew
brew install websockify

# æˆ–ç”¨ pip
pip install websockify
```

### ä½¿ç”¨æ­¥éª¤

1. **æ‰“å¼€ VNC é¡µé¢**
   ```
   http://localhost:3001/vnc.html
   ```

2. **é…ç½® VNC ç›®æ ‡ä¿¡æ¯**
   - **VNC ä¸»æœº**ï¼šè¿è¡Œ VNC æœåŠ¡çš„ä¸»æœºåœ°å€ï¼ˆå¦‚ `192.168.1.20`ï¼‰
   - **VNC ç«¯å£**ï¼šVNC æœåŠ¡ç«¯å£ï¼ˆé€šå¸¸æ˜¯ `5900` æˆ– `5901` ç­‰ï¼‰
   - **WebSocket ç«¯å£**ï¼šwebsockify å°†è¦ç›‘å¬çš„ç«¯å£ï¼ˆæ¨è `6080`ï¼Œå¿…é¡» > 1024ï¼‰

3. **ç‚¹å‡»"å¯åŠ¨ WebSocket ä»£ç†"**
   - æœåŠ¡å™¨ä¼šåœ¨ä¸»æœºä¸Šå¯åŠ¨ websockify è¿›ç¨‹
   - ä»£ç†ä¼šå°†è¯¥ WebSocket ç«¯å£è½¬å‘åˆ°ç›®æ ‡ VNC æœåŠ¡å™¨
   - å¦‚æœæˆåŠŸï¼ŒçŠ¶æ€ä¼šå˜ä¸º"ä»£ç†å·²å¯åŠ¨ï¼Œç­‰å¾…è¿æ¥..."

4. **ç‚¹å‡»"è¿æ¥ VNC"**
   - ä½¿ç”¨ noVNC å®¢æˆ·ç«¯é€šè¿‡ WebSocket è¿æ¥åˆ° VNC æœåŠ¡å™¨
   - å¦‚æœ VNC æœåŠ¡å™¨è¦æ±‚å¯†ç ï¼Œå°†æ˜¾ç¤ºç›¸å…³æç¤º
   - è¿æ¥æˆåŠŸåå¯ä»¥çœ‹åˆ°è¿œç¨‹æ¡Œé¢

5. **æ“ä½œè¿œç¨‹æ¡Œé¢**
   - ä½¿ç”¨é¼ æ ‡å’Œé”®ç›˜è¿›è¡Œæ“ä½œ
   - ç‚¹å‡»æ–­å¼€æŒ‰é’®å…³é—­è¿æ¥

### VNC æœåŠ¡å™¨æ¨è
ä»¥ä¸‹æ˜¯å¸¸è§çš„ VNC æœåŠ¡å™¨è½¯ä»¶ï¼š

**Linux ä¸Šï¼š**
- TightVNC
- RealVNC
- x11vnc
- vncserver

**Windows ä¸Šï¼š**
- TightVNC
- RealVNC
- UltraVNC
- TigerVNC

**macOS ä¸Šï¼š**
- RealVNC
- ScreenFloat
- TigerVNC

### å¸¸è§é—®é¢˜

**Qï¼šå¯åŠ¨ websockify å¤±è´¥ï¼Œæ˜¾ç¤º"å‘½ä»¤æœªæ‰¾åˆ°"ï¼Ÿ**
Aï¼šç¡®ä¿ websockify å·²å®‰è£…ä¸”åœ¨ PATH ä¸­å¯è®¿é—®ã€‚åœ¨ Windows ä¸Šï¼Œå»ºè®®åœ¨ WSL æˆ– Git Bash ä¸­å®‰è£…ã€‚

**Qï¼šè¿æ¥ VNC åçœ‹ä¸åˆ°ç”»é¢ï¼Ÿ**
Aï¼š
1. ç¡®ä¿ç›®æ ‡ VNC æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
2. ç¡®ä¿ç½‘ç»œè¿é€šæ€§ï¼ˆä½¿ç”¨ ping æˆ– telnet æµ‹è¯•ï¼‰
3. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº† VNC ç«¯å£
4. å°è¯•ç”¨æœ¬åœ° VNC å®¢æˆ·ç«¯éªŒè¯è¿æ¥

**Qï¼šWebSocket ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ**
Aï¼šä½¿ç”¨ä¸åŒçš„ WebSocket ç«¯å£ï¼ˆå¦‚ 6081ã€6082 ç­‰ï¼‰

---

## å®‰å…¨å»ºè®®

### âš ï¸ ç”Ÿäº§ç¯å¢ƒé‡è¦æç¤º

1. **ä½¿ç”¨ HTTPS/WSS**
   - å¼€å‘ç¯å¢ƒå¯ä½¿ç”¨ HTTP/WS
   - ç”Ÿäº§ç¯å¢ƒ**å¿…é¡»**ä½¿ç”¨ HTTPS/WSS
   - å¦åˆ™å‡­è¯å’Œæ•°æ®å°†ä»¥æ˜æ–‡ä¼ è¾“

2. **å‡­è¯ä¿æŠ¤**
   - SSH å¯†ç é€šè¿‡ WebSocket ä¼ è¾“ï¼ŒåŠ¡å¿…ä½¿ç”¨ TLS åŠ å¯†
   - ä¸è¦åœ¨å…¬ç½‘ä¸Šæš´éœ²è¯¥åº”ç”¨ï¼Œå»ºè®®é™åˆ¶è®¿é—® IP

3. **å®¡è®¡æ—¥å¿—**
   - æ‰€æœ‰ SSH è¿æ¥å’Œ VNC ä»£ç†å¯åŠ¨éƒ½ä¼šè¢«è®°å½•åˆ°å®¡è®¡æ—¥å¿—
   - å¯é€šè¿‡ `/api/audits` æŸ¥è¯¢å†å²è®°å½•

4. **ç«¯å£ç®¡ç†**
   - VNC å’Œ SSH ä»£ç†ç›‘å¬çš„ WebSocket ç«¯å£åº”è¯¥åœ¨é˜²ç«å¢™ä¸­å—ä¿æŠ¤
   - å»ºè®®åœ¨å†…ç½‘æˆ– VPN ä¸­è¿è¡Œ

### å¯ç”¨ HTTPS/WSSï¼ˆå¯é€‰ï¼‰

å¦‚éœ€åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå¯åœ¨ server.js ä¸­æ·»åŠ  HTTPS æœåŠ¡å™¨ï¼š

```javascript
const https = require('https');
const fs = require('fs');

const options = {
  key: fs.readFileSync('/path/to/server.key'),
  cert: fs.readFileSync('/path/to/server.crt')
};

https.createServer(options, app).listen(3002, () => {
  console.log('HTTPS Server on port 3002');
});
```

---

## æŠ€æœ¯æ¶æ„

### SSH æµç¨‹
```
æµè§ˆå™¨ (xterm.js)
    â†“
WebSocket (/ssh)
    â†“
Node.js (ssh2)
    â†“
è¿œç¨‹ SSH æœåŠ¡å™¨
```

### VNC æµç¨‹
```
æµè§ˆå™¨ (noVNC)
    â†“
WebSocket (port 6080)
    â†“
websockify ä»£ç†
    â†“
è¿œç¨‹ VNC æœåŠ¡å™¨
```

---

## API ç«¯ç‚¹

### WebSocket ç«¯ç‚¹
- **è·¯å¾„**ï¼š`/ssh`
- **æŸ¥è¯¢å‚æ•°**ï¼š`?host=<host>&port=<port>`
- **é¦–æ¡æ¶ˆæ¯**ï¼šJSON æ ¼å¼è®¤è¯ä¿¡æ¯
  ```json
  {
    "type": "auth",
    "username": "root",
    "password": "password",
    "host": "192.168.1.10",
    "port": 22
  }
  ```
- **å“åº”**ï¼š
  - è®¤è¯æˆåŠŸï¼š`{"type":"ready"}`
  - é”™è¯¯ï¼š`{"type":"error","message":"..."}`
  - åç»­æ•°æ®ï¼šåŸå§‹ shell è¾“å‡º

### REST ç«¯ç‚¹
- **POST** `/api/start-websockify`
  - è¯·æ±‚ä½“ï¼š
    ```json
    {
      "targetHost": "192.168.1.20",
      "targetPort": 5900,
      "wsPort": 6080
    }
    ```
  - å“åº”ï¼š
    ```json
    {
      "ok": true,
      "wsPort": 6080,
      "pid": 12345
    }
    ```

---

## å®¡è®¡æ—¥å¿—

æ‰€æœ‰ SSH è¿æ¥å’Œ VNC ä»£ç†æ“ä½œéƒ½ä¼šè¢«è®°å½•ã€‚å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥è¯¢ï¼š

```javascript
GET /api/audits?action=ssh.connect.attempt
GET /api/audits?action=websockify.start
```

å“åº”åŒ…å«ï¼š
- `timestamp`ï¼šæ“ä½œæ—¶é—´
- `action`ï¼šæ“ä½œç±»å‹
- `details`ï¼šè¯¦ç»†ä¿¡æ¯ï¼ˆä¸»æœºã€ç«¯å£ç­‰ï¼‰
- `user`ï¼šæ“ä½œè€…ï¼ˆæ¥è‡ª X-User è¯·æ±‚å¤´ï¼‰

---

## æ•…éšœæ’é™¤

### æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ä¾èµ–
npm list

# æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯
node server.js
```

### SSH è¿æ¥è¶…æ—¶
1. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
2. éªŒè¯ SSH æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
3. æµ‹è¯•ç½‘ç»œè¿é€šæ€§ï¼š`ping <target-host>`

### VNC è¿æ¥é»‘å±
1. ç¡®ä¿ VNC æœåŠ¡å™¨åœ¨è¿è¡Œ
2. å°è¯•ç”¨æœ¬åœ° VNC å®¢æˆ·ç«¯éªŒè¯
3. æ£€æŸ¥ websockify è¿›ç¨‹ï¼š`ps aux | grep websockify`

### WebSocket è¿æ¥é”™è¯¯
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
3. æ£€æŸ¥ç«¯å£å·æ˜¯å¦æ­£ç¡®

---

## æ–‡ä»¶ç»“æ„

```
public/
â”œâ”€â”€ index.html          # ä»ªè¡¨ç›˜ä¸»é¡µ
â”œâ”€â”€ ssh.html            # SSH ç»ˆç«¯é¡µé¢
â”œâ”€â”€ ssh.js              # SSH å‰ç«¯é€»è¾‘
â”œâ”€â”€ vnc.html            # VNC è¿œç¨‹é¡µé¢
â”œâ”€â”€ app.js              # æœºæŸœç®¡ç†å‰ç«¯
â”œâ”€â”€ styles.css          # ç»Ÿä¸€æ ·å¼
â””â”€â”€ ...

server.js              # åŒ…å« WebSocket SSH ä»£ç†å’Œ websockify å¯åŠ¨å™¨
```

---

## è®¸å¯è¯

MIT

---

## æ›´æ–°æ—¥å¿—

### v0.1 (2025-12-03)
- âœ¨ å®ç° SSH ç»ˆç«¯ï¼ˆé€šè¿‡ WebSocket + xterm.jsï¼‰
- âœ¨ é›†æˆ VNC è¿œç¨‹ï¼ˆé€šè¿‡ websockify + noVNCï¼‰
- ğŸ¨ é‡‡ç”¨ä»ªè¡¨ç›˜ç»Ÿä¸€ CSS é£æ ¼
- ğŸ“ å®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’Œå®‰å…¨å»ºè®®
